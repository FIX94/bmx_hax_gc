// Copyright 2016 FIX94
// This code is licensed to you under the terms of the GNU GPL, version 2;
// see file LICENSE or http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt

#define MSR_IR		(1<<5)
#define MSR_DR		(1<<4)

	.section .start,"ax"

0:	// we land here, below us is broken stuff
	b dorfi
	// will be garbage after our crash
	nop
dorfi:
	//get back from our current position
	lis 3,_start@h
	ori 3,3,_start@l
	mtsrr0 3
	//set some more default state again
	li 3, 0x32
	mtsrr1 3
	//back into normal code
	rfi

_start:
	// Set up a stack frame.
	lis 1,0x8000 ; addi 1,1,0x3000 ; li 0,0 ; stwu 0,-64(1)

	// Go for it!
	b _main
